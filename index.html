<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ÂåóÊµ∑ÈÅìËÅñË™ï‰πãÊóÖ 2025</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans TC', sans-serif; -webkit-tap-highlight-color: transparent; }
        #map { height: 100%; width: 100%; z-index: 1; }
        .glass-panel {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        
        @media (max-width: 768px) {
            #map-container {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                height: 60vh;
                z-index: 50;
                transform: translateY(100%);
                transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
                border-top-left-radius: 24px;
                border-top-right-radius: 24px;
                box-shadow: 0 -10px 25px -5px rgba(0, 0, 0, 0.2);
            }
            #map-container.active {
                transform: translateY(0);
            }
            .content-area {
                padding-bottom: 80px;
            }
        }

        .activity-card.active {
            border-left-width: 8px;
            background: white;
            box-shadow: 0 10px 15px -3px rgba(59, 130, 246, 0.1);
        }
        
        #mobile-map-toggle {
            display: none;
        }
        @media (max-width: 768px) {
            #mobile-map-toggle {
                display: flex;
            }
        }
        .animate-bounce-short {
            animation: bounce 1s infinite;
        }
        @keyframes bounce {
            0%, 100% { transform: translateY(-5%); animation-timing-function: cubic-bezier(0.8,0,1,1); }
            50% { transform: none; animation-timing-function: cubic-bezier(0,0,0.2,1); }
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 h-screen flex flex-col overflow-hidden">

    <!-- Header -->
    <header class="z-[60] px-6 py-4 flex justify-between items-center bg-white border-b border-blue-100 shadow-sm flex-shrink-0">
        <div>
            <h1 class="text-xl md:text-2xl font-black bg-gradient-to-r from-blue-700 to-cyan-500 bg-clip-text text-transparent flex items-center">
                ‚ùÑÔ∏è ÂåóÊµ∑ÈÅì 2025
            </h1>
        </div>
        
        <div id="day-selector-desktop" class="hidden sm:flex space-x-1 bg-blue-50 p-1 rounded-full border border-blue-100">
            <!-- Injected by JS -->
        </div>
    </header>

    <main class="flex flex-col md:flex-row flex-1 overflow-hidden relative">
        
        <!-- Sidebar / Main Content -->
        <div class="w-full md:w-[400px] lg:w-[450px] overflow-y-auto custom-scrollbar flex flex-col bg-white z-10 content-area">
            
            <div id="day-selector-mobile" class="sm:hidden p-4 overflow-x-auto whitespace-nowrap bg-white sticky top-0 z-20 border-b border-slate-100 flex items-center">
                <!-- Injected by JS -->
            </div>

            <div class="p-5 md:p-8">
                <div id="day-header" class="mb-6">
                    <span id="day-label" class="inline-block px-3 py-1 rounded-full bg-blue-100 text-blue-700 text-[10px] font-black uppercase tracking-widest mb-2"></span>
                    <h2 id="day-title" class="text-2xl font-black text-slate-800"></h2>
                    <p id="day-date" class="text-blue-500 font-bold text-sm"></p>
                </div>

                <div id="activities-container" class="space-y-4 relative pl-2">
                    <!-- Activities injected by JS -->
                </div>
            </div>
        </div>

        <!-- Map Container -->
        <div id="map-container" class="flex-1 bg-white flex flex-col">
            <div class="md:hidden w-full flex justify-center py-3 cursor-pointer" onclick="toggleMap(false)">
                <div class="w-12 h-1.5 bg-slate-300 rounded-full"></div>
            </div>
            
            <div class="flex-1 relative">
                <div id="map"></div>
                <div id="map-info" class="absolute bottom-6 left-1/2 -translate-x-1/2 w-[90%] md:w-64 glass-panel p-4 rounded-2xl shadow-xl border border-white z-[1000] hidden">
                </div>
            </div>
        </div>
    </main>

    <button id="mobile-map-toggle" onclick="toggleMap(true)" class="fixed bottom-6 right-6 w-14 h-14 bg-blue-600 text-white rounded-full shadow-2xl flex items-center justify-center z-40 animate-bounce-short">
        üìç
    </button>

    <script>
        const ITINERARY_DATA = [
            {
                day: 1, date: "12Êúà25Êó• (Âõõ)", title: "ÊäµÈÅîÊú≠Âπå & ËÅñË™ïÊ∞£Ê∞õ", region: [43.062, 141.354], zoom: 12,
                activities: [
                    { id: '1-1', time: '14:20', type: 'plane', title: 'ÊäµÈÅîÊñ∞ÂçÉÊ≠≤Ê©üÂ†¥ (CTS)', location: 'New Chitose Airport', coords: [42.787, 141.681], mapLink: 'https://maps.app.goo.gl/BE1obXLPS5pc7PkX7' },
                    { id: '1-2', time: '16:30', type: 'hotel', title: 'Hotel Emion Sapporo', location: 'Êú≠ÂπåÂ∏ÇÂåóÂå∫Âåó8Êù°Ë•ø1‰∏ÅÁõÆ', coords: [43.070, 141.353], mapLink: 'https://maps.app.goo.gl/o2rDD2H6jMgmuXbFA' },
                    { id: '1-3', time: '18:30', type: 'food', title: 'Ê†πÂÆ§Ëä±‰∏∏Ëø¥ËΩâÂ£ΩÂè∏', location: 'JR Tower Stella Place 6F', coords: [43.068, 141.350], mapLink: 'https://maps.app.goo.gl/7wnV3bZhvVJSntQu6' },
                    { id: '1-4', time: '20:00', type: 'sightseeing', title: 'Êú≠ÂπåÊÖïÂ∞ºÈªëËÅñË™ïÂ∏ÇÈõÜ üéÑ', location: 'Â§ßÈÄöÂÖ¨Âúí 2 ‰∏ÅÁõÆ', coords: [43.060, 141.354], mapLink: 'https://maps.app.goo.gl/1QuAGwm6YVT3xwGY7' }
                ]
            },
            {
                day: 2, date: "12Êúà26Êó• (‰∫î)", title: "Â∞èÊ®ΩÊµ™Êº´‰∏ÄÊó•ÈÅä", region: [43.190, 141.000], zoom: 13,
                activities: [
                    { id: '2-1', time: '09:30', type: 'transport', title: 'JR Êú≠Âπå ‚Üí Â∞èÊ®Ω', location: 'JR Otaru Station', coords: [43.197, 140.993], mapLink: 'https://maps.app.goo.gl/J4c9TFo6Xa15csJ67' },
                    { id: '2-2', time: '10:00', type: 'food', title: '„ÄêÈ†êË®Ç„Äë„ÅÜ„Å´Â∞ÇÈñÄÂ∫ó‰∏ñÂ£±Â±ã', location: '‰∏ñÂ£±Â±ã Â∞èÊ®ΩÈÅãÊ≤≥Â∫ó', coords: [43.200, 141.002], mapLink: 'https://maps.app.goo.gl/b3HULnigzKNQiYyQ8' },
                    { id: '2-3', time: '10:30', type: 'sightseeing', title: 'Êº´Ê≠•Â∞èÊ®ΩÈÅãÊ≤≥', location: 'Otaru Canal', coords: [43.201, 141.003], mapLink: 'https://maps.app.goo.gl/1u1bVJhgozQxYRMQ9' },
                    { id: '2-4', time: '11:30', type: 'photo', title: 'ËàπË¶ãÂùÇ', location: 'Funamizaka Slope', coords: [43.197, 140.994], mapLink: 'https://maps.app.goo.gl/SNUw6MvCuvwLwybt5' },
                    { id: '2-5', time: '13:00', type: 'sightseeing', title: 'Â∞èÊ®ΩÂ§©ÁãóÂ±±ËßÄÊôØËá∫', location: 'Tenguyama Ropeway', coords: [43.1978, 140.9507], mapLink: 'https://maps.app.goo.gl/3Usnd4CQ7LdeU8js9' },
                    { id: '2-7', time: '18:30', type: 'food', title: 'Áã∏Â∞èË∑ØÂïÜÂ∫óË°ó', location: 'Tanukikoji', coords: [43.057, 141.352], mapLink: 'https://maps.app.goo.gl/u5pna9UZVAmeQQ846' }
                ]
            },
            {
                day: 3, date: "12Êúà27Êó• (ÂÖ≠)", title: "Ëá™ÈßïÔºöÁæéÁëõÂÜ∞Èõ™Â∑°Á¶Æ", region: [43.550, 142.500], zoom: 10,
                activities: [
                    { id: '3-1', time: '09:30', type: 'car', title: 'Nippon Rent-A-Car ÊîûËªä', location: 'Sapporo Station', coords: [43.069, 141.354], mapLink: 'https://maps.app.goo.gl/xQ22rZqoe4t8qTfc9', mapcode: '9 553 093*58' },
                    { id: '3-2', time: '12:30', type: 'food', title: 'Farm Restaurant Chiyoda (ÁæéÁëõÁâõ)', location: 'ÁæéÁëõÁî∫Êò•Êó•Âè∞', coords: [43.558, 142.454], mapLink: 'https://maps.app.goo.gl/wUU9sHT85TbqaSWcA', mapcode: '349 734 764*54' },
                    { id: '3-3', time: '14:30', type: 'photo', title: 'ËÅñË™ïÊ®π‰πãÊú®', location: 'Christmas Tree Tree', coords: [43.636, 142.427], mapLink: 'https://maps.app.goo.gl/JZqRG89PdCmJ8Q94A', mapcode: '349 788 233*50' },
                    { id: '3-4', time: '16:30', type: 'photo', title: 'ÁôΩÈáëÈùíÊ±† (Â§úÈñìÈªûÁáà)', location: 'Blue Pond', coords: [43.493, 142.614], mapLink: 'https://maps.app.goo.gl/crPMNd3QTmQwuUmy9', mapcode: '349 568 748*77' },
                    { id: '3-5', time: '17:30', type: 'sightseeing', title: 'ÁôΩÈ¨öÁÄëÂ∏ÉÈªûÁáà', location: 'ÁôΩ„Å≤„Åí„ÅÆÊªù', coords: [43.475, 142.641], mapLink: 'https://maps.app.goo.gl/c5EgT85mLmQryrhK9', mapcode: '796 182 575*36' },
                    { id: '3-6', time: '19:00', type: 'hotel', title: 'La Vista Â§ßÈõ™Â±±', location: 'Higashikawa', coords: [43.655, 142.827], mapLink: 'https://maps.app.goo.gl/TpVqtVjUPAN1jK579', mapcode: '796 830 440*54' }
                ]
            },
            {
                day: 4, date: "12Êúà28Êó• (Êó•)", title: "Êó≠Â≤≥Èõ™ÊôØ & ÂØåËâØÈáé", region: [43.550, 142.600], zoom: 10,
                activities: [
                    { id: '4-1', time: '09:30', type: 'sightseeing', title: 'Êó≠Â≤≥Á∫úËªä (Ê®πÂÜ∞)', location: 'Asahidake Ropeway', coords: [43.663, 142.823], mapLink: 'https://maps.app.goo.gl/Ywmsbpa9m57sxzds8', mapcode: '796 861 069*65' },
                    { id: '4-3', time: '14:30', type: 'shopping', title: 'Ningle Terrace Ê£ÆÊûóÁ≤æÈùà', location: 'New Furano Prince Hotel', coords: [43.340, 142.421], mapLink: 'https://maps.app.goo.gl/Q1y5euEn5qYUEKGq5', mapcode: '919 553 456*75' },
                    { id: '4-4', time: '18:30', type: 'hotel', title: 'ËøîÈÖíÂ∫óÂòÜÊ∫´Ê≥â', location: 'La Vista Daisetsuzan', coords: [43.655, 142.827], mapLink: 'https://maps.app.goo.gl/TpVqtVjUPAN1jK579', mapcode: '796 830 440*54' }
                ]
            },
            {
                day: 5, date: "12Êúà29Êó• (‰∏Ä)", title: "ÂãïÁâ©Âúí & Êó≠Â∑ùË≥ºÁâ©", region: [43.770, 142.400], zoom: 11,
                activities: [
                    { id: '5-1', time: '11:00', type: 'sightseeing', title: 'Êó≠Â±±ÂãïÁâ©Âúí (‰ºÅÈµùÊï£Ê≠•)', location: 'Asahiyama Zoo', coords: [43.768, 142.479], mapLink: 'https://maps.app.goo.gl/L2e88nctP3aePjdr6', mapcode: '79 357 855*84' },
                    { id: '5-2', time: '14:30', type: 'shopping', title: 'AEON MALL Êó≠Â∑ùÁ´ôÂâç', location: 'Êó≠Â∑ùÂ∏ÇÂÆÆ‰∏ãÈÄö7‰∏ÅÁõÆ', coords: [43.763, 142.358], mapLink: 'https://maps.app.goo.gl/dMLNAqC85cskdwW37', mapcode: '79 343 367*05' },
                    { id: '5-3', time: '16:30', type: 'food', title: '„ÄêÈ†êË®Ç„ÄëÂ§ßÈªëÂ±ã (ÊàêÂêâÊÄùÊ±ó)', location: 'Daikokuya', coords: [43.766, 142.365], mapLink: 'https://maps.app.goo.gl/8Fwi6EWBUNKvLLo77', mapcode: '79 373 040*80' },
                    { id: '5-4', time: '19:30', type: 'car', title: 'Êó≠Â∑ù/Êú≠ÂπåÈÇÑËªä', location: 'Rental Car Return', coords: [43.069, 141.354], mapLink: 'https://maps.app.goo.gl/xQ22rZqoe4t8qTfc9', mapcode: '9 553 093*58' }
                ]
            },
            {
                day: 6, date: "12Êúà30Êó• (‰∫å)", title: "ÂõûÁ®ãÈ¶ôÊ∏Ø", region: [42.900, 141.500], zoom: 10,
                activities: [
                    { id: '6-1', time: '10:00', type: 'hotel', title: 'Check-out', location: 'Hotel Emion', coords: [43.070, 141.353], mapLink: 'https://maps.app.goo.gl/o2rDD2H6jMgmuXbFA' },
                    { id: '6-2', time: '15:20', type: 'plane', title: 'È£õËøîÈ¶ôÊ∏Ø (HX691)', location: 'New Chitose Airport', coords: [42.787, 141.681], mapLink: 'https://maps.app.goo.gl/BE1obXLPS5pc7PkX7' }
                ]
            }
        ];

        let activeDay = 1;
        let map, markers = [], routeLine;

        function initMap() {
            map = L.map('map', { zoomControl: false, scrollWheelZoom: true, dragging: true }).setView(ITINERARY_DATA[0].region, ITINERARY_DATA[0].zoom);
            L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
                attribution: '&copy; CARTO'
            }).addTo(map);
            L.control.zoom({ position: 'bottomright' }).addTo(map);
            renderDay(1);
        }

        function toggleMap(show) {
            const container = document.getElementById('map-container');
            if (show) {
                container.classList.add('active');
            } else {
                container.classList.remove('active');
            }
            setTimeout(() => map.invalidateSize(), 400);
        }

        function getIcon(type) {
            const icons = { plane: '‚úàÔ∏è', food: 'üç¥', hotel: 'üè†', sightseeing: 'üì∏', shopping: 'üõçÔ∏è', transport: 'üöÉ', car: 'üöó', photo: 'üì∑' };
            return icons[type] || 'üìç';
        }

        function renderDay(dayNum) {
            activeDay = dayNum;
            const data = ITINERARY_DATA.find(d => d.day === dayNum);
            
            document.getElementById('day-label').innerText = `DAY ${data.day}`;
            document.getElementById('day-title').innerText = data.title;
            document.getElementById('day-date').innerText = data.date;

            const container = document.getElementById('activities-container');
            container.innerHTML = '';

            data.activities.forEach((act, idx) => {
                const card = document.createElement('div');
                card.className = `activity-card flex flex-col p-4 rounded-2xl border border-slate-100 bg-white cursor-pointer transition-all mb-4 shadow-sm`;
                
                // ÈªûÊìäÂç°ÁâáËß∏ÁôºÂú∞ÂúñÁßªÂãï (ÊéíÈô§ÊåâÈàïÈªûÊìä)
                card.onclick = (e) => {
                    if (e.target.closest('a')) return; 
                    if (window.innerWidth <= 768) toggleMap(true);
                    document.querySelectorAll('.activity-card').forEach(c => c.classList.remove('active', 'border-blue-300'));
                    card.classList.add('active', 'border-blue-300');
                    map.flyTo(act.coords, 15);
                    L.popup().setLatLng(act.coords).setContent(`<strong>${act.title}</strong>`).openOn(map);
                };

                // Mapcode Ë°å (Â¶ÇÊûúÊúâÊèê‰æõÁöÑË©±)
                const mapcodeHtml = act.mapcode ? `<p class="text-[10px] font-bold text-blue-600 bg-blue-50 px-2 py-0.5 rounded mt-1 inline-block">Mapcode: ${act.mapcode}</p>` : '';

                card.innerHTML = `
                    <div class="flex items-start">
                        <div class="mr-4 mt-1 w-8 h-8 flex-shrink-0 bg-blue-50 text-blue-600 rounded-lg flex items-center justify-center font-black text-sm">
                            ${idx + 1}
                        </div>
                        <div class="flex-1">
                            <div class="flex justify-between items-center mb-1">
                                <span class="text-[10px] font-bold text-slate-400 uppercase tracking-tighter">${act.time}</span>
                                <span>${getIcon(act.type)}</span>
                            </div>
                            <h3 class="font-bold text-slate-800 leading-tight">${act.title}</h3>
                            <p class="text-xs text-slate-500 mt-1">üìç ${act.location}</p>
                            ${mapcodeHtml}
                        </div>
                    </div>
                    <a href="${act.mapLink}" target="_blank" class="mt-3 flex items-center justify-center w-full bg-slate-50 hover:bg-blue-600 hover:text-white text-slate-600 text-[11px] font-bold py-2 px-4 rounded-xl transition-all border border-slate-100">
                        üó∫Ô∏è Google Map Â∞éËà™
                    </a>
                `;
                container.appendChild(card);
            });

            // Ê∏ÖÈô§ÁèæÊúâÊ®ôË®ò
            markers.forEach(m => map.removeLayer(m));
            markers = [];
            if (routeLine) map.removeLayer(routeLine);

            // Áπ™Ë£ΩËôõÁ∑öË∑ØÂæë
            const coords = data.activities.map(a => a.coords);
            routeLine = L.polyline(coords, { color: '#3b82f6', weight: 3, opacity: 0.4, dashArray: '5, 8' }).addTo(map);

            // Âä†ÂÖ•Êñ∞Ê®ôË®ò
            data.activities.forEach(act => {
                const marker = L.marker(act.coords).addTo(map);
                marker.bindPopup(`<strong>${act.title}</strong>`);
                markers.push(marker);
            });

            map.flyTo(data.region, data.zoom);
            updateSelectors();
        }

        function updateSelectors() {
            const desktop = document.getElementById('day-selector-desktop');
            const mobile = document.getElementById('day-selector-mobile');
            desktop.innerHTML = '';
            mobile.innerHTML = '';

            ITINERARY_DATA.forEach(d => {
                const isActive = activeDay === d.day;
                
                const dBtn = document.createElement('button');
                dBtn.className = `px-4 py-1.5 rounded-full text-xs font-bold transition-all ${isActive ? 'bg-white text-blue-700 shadow-sm' : 'text-slate-500 hover:text-blue-600'}`;
                dBtn.innerText = `Day ${d.day}`;
                dBtn.onclick = () => renderDay(d.day);
                desktop.appendChild(dBtn);

                const mBtn = document.createElement('button');
                mBtn.className = `inline-block px-5 py-2 mr-2 rounded-full text-xs font-bold transition-all ${isActive ? 'bg-blue-600 text-white shadow-lg' : 'bg-slate-100 text-slate-500'}`;
                mBtn.innerText = `D${d.day}`;
                mBtn.onclick = () => renderDay(d.day);
                mobile.appendChild(mBtn);
            });
        }

        window.onload = initMap;
    </script>
</body>
</html>